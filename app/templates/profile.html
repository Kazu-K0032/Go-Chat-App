{{ define "content" }}
<!-- ラッパとしてのレイアウトコンテナ -->
<div class="l-container">
  <!-- プロフィール部分 -->
  <section class="p-profile">
    <div class="p-profile__icon-wrap c-icon__wrap">
      <!-- アイコン画像 -->
      <form action="/profile/icon" method="POST" enctype="multipart/form-data">
        <label for="icon-upload" class="c-icon__label">
          <img
            src="{{ .User.IconURL }}"
            alt="アイコン"
            class="c-icon__img"
            id="profile-icon"
            onerror="this.onerror=null; this.src='{{ getRandomDefaultIcon }}';"
          />
          <input
            type="file"
            id="icon-upload"
            name="icon"
            accept="image/*"
            class="c-icon__input"
            style="display: none"
            onchange="handleIconChange(event)"
          />
        </label>
      </form>
    </div>

    <h1 class="p-profile__name">{{.User.Name}}</h1>
    <p class="p-profile__email">{{.User.Email}}</p>
    <p class="p-profile__created-date">
      アカウント作成日: {{.User.CreatedAt.Format "2006-01-02"}}
    </p>

    <!-- フォロー情報など -->
    <ul class="p-profile-stats">
      <li class="p-profile-stats__item">
        最終更新: {{.User.UpdatedAt.Format "2006-01-02 15:04:05"}}
      </li>
      <li class="p-profile-stats__item">
        アカウント作成: {{.User.CreatedAt.Format "2006-01-02"}}
      </li>
    </ul>
  </section>

  <!-- タブナビゲーション -->
  <nav class="p-tabs">
    <ul class="p-tabs__list">
      <li class="p-tabs__item">
        <a href="#posts" class="p-tabs__link is-active" data-tab="posts"
          >投稿</a
        >
      </li>
      <li class="p-tabs__item">
        <a href="#replies" class="p-tabs__link" data-tab="replies">返信</a>
      </li>
      <li class="p-tabs__item">
        <a href="#likes" class="p-tabs__link" data-tab="likes">いいね</a>
      </li>
    </ul>
  </nav>

  <!-- タブコンテンツ -->
  <div class="p-tab-contents">
    <!-- 投稿タブ -->
    <section id="posts" class="p-post-list is-active">
      {{range .Tweets}}
      <article class="p-post-list__item">
        <p class="p-post-list__content">{{.Content}}</p>
        <time class="p-post-list__date">{{.Date}}</time>
      </article>
      {{end}}
    </section>

    <!-- 返信タブ -->
    <section id="replies" class="p-post-list">
      {{range .Replies}}
      <article class="p-post-list__item">
        <p class="p-post-list__content">{{.Content}}</p>
        <time class="p-post-list__date">{{.Date}}</time>
      </article>
      {{end}}
    </section>

    <!-- いいねタブ -->
    <section id="likes" class="p-post-list">
      {{range .Likes}}
      <article class="p-post-list__item">
        <p class="p-post-list__content">{{.Content}}</p>
        <time class="p-post-list__date">{{.Date}}</time>
      </article>
      {{end}}
    </section>
  </div>
</div>

<script>
  // アイコン画像の変更を処理する関数
  function handleIconChange(event) {
    const file = event.target.files[0];
    if (file) {
      // 画像のプレビューを表示
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.getElementById("profile-icon");
        img.src = e.target.result;

        // フォームを自動送信
        event.target.form.submit();
      };
      reader.readAsDataURL(file);
    }
  }

  // ページ読み込み時に保存された画像を復元
  document.addEventListener("DOMContentLoaded", function () {
    const savedIcon = localStorage.getItem("selectedIcon");
    if (savedIcon) {
      const img = document.getElementById("profile-icon");
      img.src = savedIcon;
    }
  });
</script>
{{ end }}
